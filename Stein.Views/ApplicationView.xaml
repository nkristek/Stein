<UserControl x:Class="Stein.Views.ApplicationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:adonisUi="clr-namespace:AdonisUI;assembly=AdonisUI"
             xmlns:adonisControls="clr-namespace:AdonisUI.Controls;assembly=AdonisUI"
             xmlns:converters="clr-namespace:NKristek.Wpf.Converters;assembly=NKristek.Wpf.Converters"
             xmlns:localization="clr-namespace:Stein.Localizations;assembly=Stein.Localizations"
             xmlns:viewModels="clr-namespace:Stein.ViewModels;assembly=Stein.ViewModels"
             xmlns:adonisExtensions="clr-namespace:AdonisUI.Extensions;assembly=AdonisUI"
             xmlns:steinconverters="clr-namespace:Stein.Views.Converters"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:resources="clr-namespace:Stein.Views.Resources"
             mc:Ignorable="d"
             d:DataContext="{d:DesignInstance viewModels:ApplicationViewModel, IsDesignTimeCreatable=True}">

    <GroupBox Padding="8" 
              Margin="0,4" 
              SnapsToDevicePixels="True"
              HorizontalAlignment="Stretch"
              VerticalAlignment="Stretch"
              adonisExtensions:LayerExtension.Layer="1">
        <GroupBox.Header>
            <Grid Grid.Column="7">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="8"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0"
                           Margin="2,0,0,0"
                           FontWeight="Bold"
                           VerticalAlignment="Center"
                           FontSize="14"
                           Text="{Binding Name}"/>

                <Button Grid.Column="3"
                        Style="{DynamicResource {x:Static adonisUi:Styles.ToolbarButton}}"
                        Width="24"
                        Height="24"
                        Padding="4"
                        ContentTemplate="{DynamicResource EditIconVariant}"
                        Command="{Binding EditApplicationCommand}"/>

                <Button Grid.Column="4"
                        Style="{DynamicResource {x:Static adonisUi:Styles.ToolbarButton}}"
                        Width="24"
                        Height="24"
                        Padding="4"
                        ContentTemplate="{DynamicResource DeleteIconVariant}"
                        Command="{Binding DeleteApplicationCommand}"/>
            </Grid>
        </GroupBox.Header>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="Auto" 
                                  SharedSizeGroup="DateColumn"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="Auto" 
                                  SharedSizeGroup="ButtonColumn"/>
            </Grid.ColumnDefinitions>

            <ComboBox Grid.Column="0"
                      ItemsSource="{Binding InstallerBundles}"
                      SelectedItem="{Binding SelectedInstallerBundle}"
                      IsEnabled="{Binding InstallerBundles, Converter={converters:ICollectionNullOrEmptyToInverseBoolConverter}}"
                      HorizontalContentAlignment="Stretch"
                      ScrollViewer.CanContentScroll="True"
                      VirtualizingStackPanel.IsVirtualizing="True"
                      VirtualizingStackPanel.VirtualizationMode="Recycling"
                      VirtualizingStackPanel.ScrollUnit="Pixel">

                <ComboBox.ItemsPanel>
                    <ItemsPanelTemplate >
                        <VirtualizingStackPanel/>
                    </ItemsPanelTemplate>
                </ComboBox.ItemsPanel>

                <ComboBox.ItemTemplate>
                    <DataTemplate DataType="{x:Type viewModels:InstallerBundleViewModel}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Name & Culture --> 
                            <TextBlock Grid.Column="0"
                                       TextTrimming="CharacterEllipsis">
                                <TextBlock.Text>
                                    <MultiBinding StringFormat="{}{0} - {1}">
                                        <Binding Path="Name"/>
                                        <Binding Path="Culture"/>
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>

                            <!-- Installed count -->  
                            <TextBlock Grid.Column="2"
                                       Foreground="{DynamicResource {x:Static adonisUi:Brushes.DisabledForegroundBrush}}"
                                       Text="{Binding InstalledSummary}"/>
                        </Grid>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>

            <TextBlock Grid.Column="2"
                       VerticalAlignment="Center"
                       DataContext="{Binding SelectedInstallerBundle}"
                       Text="{Binding NewestInstallerCreationTime, Converter={steinconverters:DateTimeToRelativeStringConverter}, ConverterParameter=g}"> 
                <i:Interaction.Behaviors>
                    <resources:PeriodicBindingUpdateBehavior Interval="0:00:05" Property="{x:Static TextBlock.TextProperty}" Mode="UpdateTarget" />
                </i:Interaction.Behaviors>
            </TextBlock>

            <adonisControls:SplitButton Grid.Column="4"
                                  Content="{x:Static localization:Strings.Install}"
                                  Padding="16,4"
                                  Command="{Binding InstallApplicationCommand}">
                <adonisControls:SplitButton.SplitMenu>
                    <ContextMenu>
                        <MenuItem Header="{x:Static localization:Strings.Install}"
                                  Command="{Binding InstallApplicationCommand}"/>
                        <MenuItem Header="{x:Static localization:Strings.Uninstall}"
                                  Command="{Binding UninstallApplicationCommand}"/>
                        <MenuItem Header="{x:Static localization:Strings.Custom}" 
                                  Command="{Binding CustomOperationApplicationCommand}"/>
                    </ContextMenu>
                </adonisControls:SplitButton.SplitMenu>
            </adonisControls:SplitButton>
        </Grid>
    </GroupBox>
</UserControl>
